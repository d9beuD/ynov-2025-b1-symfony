{% extends 'base.html.twig' %}

{% block title %}{{ post.title }}{% endblock %}

{% block body %}
    <div class="container my-5">
        <div class="row">
            <div class="col">
                {# Post header #}
                <div class="row align-items-center gx-1 mb-3">
                    <div class="col-auto">
                        <i class="fa-solid fa-circle-user fs-1 text-primary"></i>
                    </div>
                    <div class="col-auto lh-sm">
                        <div>
                            <a
                                class="link-dark link-underline-opacity-0 link-underline-opacity-100-hover" 
                                href="{{ path('app_topic_show', { id: post.topic.id }) }}"
                            >{{ post.topic.title }}</a>
                            â€¢ {{ post.postedAt ? post.postedAt|date('d/m/Y H:i:s') : '' }}
                        </div>
                        <div>{{ post.author.email }}</div>
                    </div>
                </div>

                {# Post content #}
                <h1>{{ post.title }}</h1>
                <p class="lead">{{ post.content }}</p>

                {# Post actions #}
                <div class="mb-5">
                    <div class="btn-group">
                        <a
                            href="{{ path('app_post_upvote', { id: post.id }) }}"
                            class="btn btn-secondary rounded-start-5 btn-sm {{ hasUpvoted ? 'active':'' }}"
                        >
                            <i class="fa-solid fa-up"></i>
                        </a>
                        <div class="bg-secondary text-bg-secondary py-1 px-2 align-middle" disabled>
                            <small>{{ upvotesCount - downvotesCount }}</small>
                        </div>
                        <a
                            href="{{ path('app_post_downvote', { id: post.id }) }}" 
                            class="btn btn-secondary rounded-end-5 btn-sm {{ hasDownvoted ? 'active':'' }}"
                        >
                            <i class="fa-solid fa-down"></i>
                        </a>
                    </div>
                    
                    <button class="btn btn-secondary rounded-pill btn-sm">
                        <i class="fa-solid fa-comment"></i>
                        Commentaires
                    </button>
                    <button class="btn btn-secondary rounded-pill btn-sm">
                        <i class="fa-solid fa-medal"></i>
                    </button>
                    <button class="btn btn-secondary rounded-pill btn-sm">
                        <i class="fa-solid fa-share"></i>
                        Partager
                    </button>
                </div>

                {# Comment form #}
                {{ form_start(form) }}
                    <h2 class="h4">Commenter</h2>
                    {{ form_errors(form) }}
                    {{ form_row(form.content, {label: false, attr: { rows: 4, style: 'resize: none;' } }) }}
                    <div class="text-end">
                        <button type="submit" class="btn btn-primary rounded-pill">
                            <i class="fa-solid fa-arrow-right"></i>
                            Commenter
                        </button>
                    </div>
                    {{ form_widget(form.post, { value: post.id }) }}
                {{ form_end(form) }}

                {# Existing comments #}
                <ul class="list-unstyled">
                    {% for comment in post.comments %}
                        <li>
                            <twig:Comment comment="{{ comment }}" />
                        </li>
                    {% endfor %}
                </ul>
            </div>

            {# Aside #}
            <div class="col-sm-4 col-md-3">
                <div class="bg-body-tertiary p-3 rounded-3 mb-3 border position-relative">
                    <h2 class="h5">{{ post.topic.title }}</h2>
                    <p class="mb-0">{{ post.topic.description }}</p>
                    <a class="stretched-link" href="{{ path('app_topic_show', { id: post.topic.id }) }}"></a>
                </div>

                <div class="d-flex flex-column gap-1">
                    <a class="btn btn-primary d-block text-start" href="{{ path('app_post_edit', {'id': post.id}) }}">
                        <i class="fa-solid fa-fw fa-edit"></i>
                        Modifier la publication
                    </a>
                    {{ include('post/_delete_form.html.twig') }}
                </div>
            </div>
        </div>
    </div>
{% endblock %}
